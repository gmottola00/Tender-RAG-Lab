<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dettaglio gara</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/static/offcanvas.css">
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <nav class="navbar navbar-light bg-light shadow-sm sticky-top">
    <div class="container-fluid">
      <button class="btn btn-outline-dark btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#global-offcanvas" aria-controls="global-offcanvas">
        â˜°
      </button>
      <div class="d-flex flex-column">
        <span class="fw-bold">Dettaglio gara</span>
        <small class="text-muted">Visualizza, aggiorna e registra documenti</small>
      </div>
      <a href="/demo" class="btn btn-link btn-sm">Torna alla lista</a>
    </div>
  </nav>

  <header class="container py-3">
    <h1 class="h4">Dettaglio gara</h1>
    <p class="text-muted">Visualizza e aggiorna i dati di una gara esistente.</p>
  </header>

  <main class="grid">
    <section class="card">
      <h2>Informazioni gara</h2>
      <form id="tender-detail-form">
        <label>Codice <input type="text" name="code"></label>
        <label>Titolo <input type="text" name="title" required></label>
        <label>Descrizione <textarea name="description"></textarea></label>
        <label>Buyer <input type="text" name="buyer"></label>
        <label>Stato
          <select name="status" id="status-select">
            <option value="">(nessuno)</option>
            <option value="draft">draft</option>
            <option value="published">published</option>
            <option value="open">open</option>
            <option value="closed">closed</option>
            <option value="awarded">awarded</option>
            <option value="cancelled">cancelled</option>
          </select>
        </label>
        <label>Data pubblicazione <input type="date" name="publish_date"></label>
        <label>Data chiusura <input type="date" name="closing_date"></label>
        <button type="submit">Aggiorna</button>
      </form>
      <div id="detail-message" class="message"></div>
    </section>

    <section class="card">
      <h2>Registra documento (metadata)</h2>
      <form id="document-form">
        <input type="hidden" name="tender_id" id="doc-tender-id">
        <label>Lot (opzionale) <input type="text" name="lot_id" placeholder="UUID lotto"></label>
        <label>Nome file selezionato
          <input type="text" name="filename" id="filename-input" placeholder="Seleziona o trascina un file" readonly required>
        </label>
        <div class="dropzone" id="doc-dropzone" role="button" tabindex="0" aria-label="Carica documento">
          <p>Trascina un file qui oppure clicca per selezionarlo</p>
          <input type="file" id="doc-file-input" name="file" style="display:none">
        </div>
        <label>Tipo documento
          <select name="document_type" id="document-type-select" required>
            <option value="">Seleziona...</option>
            <option value="bando">Bando</option>
            <option value="capitolato">Capitolato</option>
            <option value="disciplinare">Disciplinare</option>
            <option value="rettifica">Rettifica</option>
            <option value="avviso">Avviso</option>
            <option value="chiarimenti">Chiarimenti</option>
            <option value="qa">Q&A</option>
            <option value="altro">Altro</option>
          </select>
        </label>
        <label>Hash file (opzionale) <input type="text" name="file_hash"></label>
        <label>Caricato da <input type="text" name="uploaded_by"></label>
        <button type="submit">Registra documento</button>
      </form>
      <div id="document-message" class="message"></div>
    </section>

    <section class="card" id="documents-card">
      <h2>Documenti della gara</h2>
      <ul class="list" id="documents-list"></ul>
      <button id="ingest-all-btn" type="button">Indicizza tutti i documenti</button>
      <div id="documents-message" class="message"></div>
    </section>

  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/static/offcanvas.js"></script>
  <script src="/static/tender_detail.js?v=6"></script>
</body>
</html>
